<!doctype html>
<html lang="ru">
<head>
    <title>Конвертация .schem в .schematic</title>

    <!-- https://github.com/kpanuragh/zlib -->
    <script src="zlib.js"></script>

    <!-- https://github.com/sjmulder/nbt-js -->
    <script src="nbt.js"></script>

    <script src="schemtoschematic.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
          crossorigin="anonymous">

    <script>
        function uploadFile(file) {
            console.log('Обработка ' + file.name);
            var fr = new FileReader();
            fr.onload = function () {
                schemtoschematic(fr.result, function (data) {
                    var name = file.name;

                    if (~name.lastIndexOf('.')) {
                        name = name.substr(0, name.lastIndexOf('.'));
                    }

                    name += '.schematic';

                    var blob = new Blob([data], {type: 'application/nbt'});
                    var link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = name;
                    link.innerHTML = 'Скачать ' + name;
                    link.classList.add('btn', 'btn-primary', 'mt-2');
                    link.click();
                    var li = document.createElement('li');
                    li.classList.add('list-group-item');
                    li.appendChild(link);
                    document.querySelector('#downloads').appendChild(li);
                });
            };
            fr.readAsArrayBuffer(file);
        }

        function upload(input) {
            for (var i = 0; i < input.files.length; i++) {
                uploadFile(input.files[i]);
            }
        }
    </script>

    <style>
        html, body {
            height: 100%;
        }

        body {
            background: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        section {
            background: white;
            box-shadow: 0 0 5px #aaa;
            padding: 25px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<section class="container mt-5">
    <h1 class="display-4 mb-4 text-center">Конвертация файлов .schem в .schematic</h1>
    <p class="text-center mb-4">Конвертируйте новые файлы WorldEdit 1.13+ .schem в старые файлы .schematic.</p>

    <div class="text-center mb-4">
        <button onclick="getVimeWorldBlocksList()" type="button" class="btn btn-primary btn-lg">Загрузить список
            блоков
        </button>
    </div>

    <div class="mb-4">
        <label for="file" class="form-label fs-5">Загрузите ваш файл .schem здесь</label>
        <input id="file" type="file" accept=".schem" class="form-control" onchange="upload(this)" multiple/>
    </div>

    <small class="d-block text-center text-muted mb-4">
        Политика конфиденциальности: Все загруженные схемы остаются на вашем локальном компьютере и не обрабатываются
        сервером.
    </small>

    <ul id="downloads" class="list-group mb-4"></ul>
    <p id="error" class="text-danger text-center"></p>
</section>
</body>
</html>
